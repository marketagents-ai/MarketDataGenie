# SWE (Software Engineering) Utilities

This directory contains utilities for working with SWE-bench datasets in Pythonformer.

## Files

### Core Modules

- **`docker_repl.py`** - Docker container management for SWE tasks
  - `DockerREPLSession`: Manages Docker containers with REPL servers
  - `LocalRepoManager`: Manages local repository clones (for development)
  - Automatically pulls SWE-smith images and starts REPL servers inside containers

### Data Files

- **`repo_data.json`** - Repository metadata for all 131 SWE-smith repositories
  - Repository names
  - Task counts
  - Docker image sizes
  - Generated by `check_image_sizes.py`

### Utilities

- **`check_image_sizes.py`** - Utility to check Docker image sizes from Docker Hub
  - Queries Docker Hub API for all SWE-smith images
  - Generates `repo_data.json` with size information
  - Useful for finding smallest repos for testing

## Usage

### Using Docker for SWE Tasks

The Docker integration is automatic when using `environment: swe` in your config:

```yaml
# configs/swe_config.yaml
dataset:
  environment: swe
  dataset_name: "SWE-bench/SWE-smith-py"
  filter_repos:
    - "swesmith/pytest-dev__iniconfig.16793ead"  # 63 tasks, 1.23 GB
```

The pipeline will:
1. Pull the Docker image (if not cached)
2. Start a container with the repository at `/testbed`
3. Run the REPL server inside the container
4. Execute agent code with access to the repository
5. Clean up the container after completion

### Finding Small Repos for Testing

Check `repo_data.json` for repository sizes:

```bash
# View smallest repos
cat datagenie/pythonformer/swe/repo_data.json | jq 'sort_by(.size_bytes) | .[0:10]'
```

Or regenerate the data:

```bash
python datagenie/pythonformer/swe/check_image_sizes.py
```

### Manual Docker Usage

```python
from datagenie.pythonformer.swe import DockerREPLSession
from datagenie.pythonformer.repl_client import REPLClient

# Start container
with DockerREPLSession(
    image_name="swebench/swesmith.x86_64.pytest-dev_1776_iniconfig.16793ead",
    instance_id="test-task-001"
) as repl_url:
    # Connect client
    client = REPLClient(repl_url)
    
    # Execute code with access to /testbed
    result = client.execute("""
with open('/testbed/README.md', 'r') as f:
    print(f.read())
""")
    print(result.output)
```

## Docker Image Sizes

- **Smallest**: 1.18 GB (google__textfsm, pwaller__pyfiglet)
- **Average**: 1.40 GB
- **Largest**: 7.16 GB (stanfordnlp__string2string)
- **Most repos**: 1.2-1.5 GB

See `repo_data.json` for complete data.

## Configuration

### Enable/Disable Docker

Docker is automatically used for SWE tasks. To skip Docker (for testing):

```yaml
dataset:
  skip_docker: true  # Use local REPL server (no /testbed)
```

### Select Specific Repositories

```yaml
dataset:
  filter_repos:
    - "swesmith/google__textfsm.c31b6007"      # 79 tasks, 1.18 GB (smallest)
    - "swesmith/pytest-dev__iniconfig.16793ead" # 63 tasks, 1.23 GB
```

## See Also

- `../DOCKER_SETUP.md` - Docker setup guide
- `../SWE_QUICK_START.md` - Quick start guide
- `../configs/swe_config.yaml` - Example configuration
